<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Nearest Hospitals</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/2749/2749678.png" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
     <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
     <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
</head>
<body>
    <div id="map"></div>
    <style>#map{height: 500px;}</style>
    <div id="bt">
       <button id="locate-btn">Locate Me</button>
   </div>
    <script>
        var map = L.map('map').setView([6.927, 79.861], 13);
                  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(map);
    
        var hospitals = [
        { name: "National Hospital Sri Lanka", lat: 6.927079, lng: 79.861244 },
        { name: "Lanka Hospitals", lat: 6.8964, lng: 79.8770 },
        { name: "Asiri Central Hospital", lat: 6.9022, lng: 79.8695 },
        { name: "Nawaloka Hospital", lat: 6.9163, lng: 79.8560 }];
        
        hospitals.forEach(function (h) {
            L.marker([h.lat,h.lng]).addTo(map).bindPopup(h.name);
        });

        var routingcontrol=null;
        var usermarker=null;
        var clickermarker=null;

        function Nearest(startingPoint){
            var neasresthospital=null;
            var nearestdistance=Infinity;

            hospitals.forEach(function(h){
                var distance=startingPoint.distanceTo([h.lat,h.lng]);
                if(distance<nearestdistance){
                    nearestdistance=distance;
                    neasresthospital=h;
                }
            });
        if (!neasresthospital) return;

        if (routingcontrol) {
            map.removeControl(routingcontrol);
        }
        routingcontrol=L.Routing.control({
            waypoints:[startingPoint,
                L.latLng(neasresthospital.lat,neasresthospital.lng)],
                lineOptions : {addWaypoints:false},
                showAlternatives:false
        }).addTo(map);
        return neasresthospital;
        }  

        function locateuser(){
            map.locate({setView:true,maxZoom:14});
        }

        map.on('locationfound',function(e){
            if (usermarker) map.removeLayer(usermarker);
            usermarker=L.marker(e.latlng).addTo(map).bindPopup("ðŸ“ You Are Here").openPopup();
            Nearest(e.latlng)
        });
        
        map.on('locationerror', function() {
        alert("âš  Location blocked! Click on the map instead.");
        });

        map.on('click',function(e){
            if (clickermarker) map.removeLayer(clickermarker);
            clickermarker=L.marker(e.latlng).addTo(map).bindPopup("ðŸ“Œ Start Point").openPopup();
            Nearest(e.latlng);
        });

       window.onload=function(){
        locateuser();
        document.getElementById("locate-btn").addEventListener("click",function(){
            locateuser();
        });
       };

    </script>
</body>
</html>