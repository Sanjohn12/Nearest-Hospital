<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Nearest Hospitals</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/2749/2749678.png" type="image/x-icon">
    <link rel="stylesheet" href="Hospital.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
     <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
     <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
</head>
<body>
    <div class="top">
        <div class="title"><h1>Find Nearest Hospitals</h1></div>
    </div>
    <div id="map"></div>

<script>
        var hospitalIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/128/3448/3448513.png",
    iconSize: [32, 32],
    iconAnchor: [16, 32]
});

var userIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/128/3710/3710297.png",
    iconSize: [32, 32],
    iconAnchor: [16, 32]
});


var UseIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/128/1365/1365700.png",
    iconSize: [32, 32],
    iconAnchor: [16, 32]
});
        var map = L.map('map').setView([6.927, 79.861], 13);
                  L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', 
  {
    attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom',
    maxZoom: 20
  }
).addTo(map);

    
        var hospitals = [];

// ‚úÖ Load hospitals from GitHub GeoJSON
fetch("https://raw.githubusercontent.com/Sanjohn12/Nearest-Hospital/refs/heads/main/Hospital.geojson")
  .then(response => response.json())
  .then(data => {
      data.features.forEach(f => {
          const [lng, lat] = f.geometry.coordinates; // GeoJSON order
          hospitals.push({
              name: f.properties.name,
              lat: lat,
              lng: lng
          });

          // ‚úÖ Add marker to map
          L.marker([lat, lng], { icon: hospitalIcon }).addTo(map).bindPopup(f.properties.name);
      });

      console.log("‚úÖ Hospitals Loaded:", hospitals);
  })
  .catch(err => console.error("‚ùå Error loading GeoJSON", err));
        
       

        var routingcontrol=null;
        var usermarker=null;
        var clickermarker=null;

        function Nearest(startingPoint){
            var neasresthospital=null;
            var nearestdistance=Infinity;

            hospitals.forEach(function(h){
                var distance=startingPoint.distanceTo([h.lat,h.lng]);
                if(distance<nearestdistance){
                    nearestdistance=distance;
                    neasresthospital=h;
                }
            });
        if (!neasresthospital) return;

        if (routingcontrol) {
            map.removeControl(routingcontrol);
        }
        routingcontrol=L.Routing.control({
            waypoints:[startingPoint,
                L.latLng(neasresthospital.lat,neasresthospital.lng)],
                lineOptions : {addWaypoints:false},
                showAlternatives:false,
                createMarker: function() { return null; }
        }).addTo(map);
        L.popup()
    .setLatLng([neasresthospital.lat, neasresthospital.lng])
    .setContent(`<b>${neasresthospital.name}</b>`)
    .openOn(map);
        }  

        function locateuser(){
            map.locate({setView:true,maxZoom:14});
        }

        map.on('locationfound',function(e){
            if (usermarker) map.removeLayer(usermarker);
            usermarker=L.marker(e.latlng,{icon:UseIcon}).addTo(map).bindPopup("üìç You Are Here").openPopup();
            Nearest(e.latlng)
        });
        
        map.on('locationerror', function() {
        alert("‚ö† Location blocked! Click on the map instead.");
        });

        map.on('click',function(e){
            if (clickermarker) map.removeLayer(clickermarker);
            clickermarker=L.marker(e.latlng,{icon: userIcon}).addTo(map).bindPopup("üìå Start Point").openPopup();
            Nearest(e.latlng);
        });

       window.onload=function(){
        locateuser();
        document.getElementById("locate-btn").addEventListener("click",function(){
            locateuser();
        });
       };

    </script>
   
</body>
</html>